(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-aed28342"],{"3c54":function(e,t,a){},5104:function(e,t,a){"use strict";a("3c54")},ee18:function(e,t,a){"use strict";a.r(t);var o=a("7a23");const l={style:{display:"none"}};function c(e,t,a,c,n,i){const r=Object(o["T"])("a-button"),b=Object(o["T"])("upload-outlined"),s=Object(o["T"])("a-upload"),u=Object(o["T"])("a-space"),d=Object(o["T"])("a-layout-header"),p=Object(o["T"])("a-empty"),f=Object(o["T"])("a-image"),O=Object(o["T"])("file-image-outlined"),h=Object(o["T"])("edit-outlined"),j=Object(o["T"])("delete-outlined"),m=Object(o["T"])("a-popconfirm"),v=Object(o["T"])("a-card"),g=Object(o["T"])("a-image-preview-group"),y=Object(o["T"])("a-input"),w=Object(o["T"])("a-form-item"),k=Object(o["T"])("a-textarea"),D=Object(o["T"])("a-form"),I=Object(o["T"])("a-modal"),T=Object(o["T"])("a-layout-content"),C=Object(o["T"])("a-layout");return Object(o["J"])(),Object(o["k"])(C,null,{default:Object(o["fb"])(()=>[Object(o["p"])(d,null,{default:Object(o["fb"])(()=>[Object(o["p"])(u,null,{default:Object(o["fb"])(()=>[Object(o["p"])(r,{size:"default",onClick:e.handleBack},{default:Object(o["fb"])(()=>[Object(o["o"])("返回")]),_:1},8,["onClick"]),Object(o["p"])(s,{name:"file",action:"/album-photo/upload",accept:"image/*",multiple:!0,data:{albumId:e.albumId},withCredentials:!0,"show-upload-list":!1,"before-upload":e.beforeUpload,onChange:e.handleUpload},{default:Object(o["fb"])(()=>[Object(o["p"])(r,null,{default:Object(o["fb"])(()=>[Object(o["p"])(b),Object(o["o"])(" 上传照片 ")]),_:1})]),_:1},8,["data","before-upload","onChange"])]),_:1})]),_:1}),Object(o["p"])(T,null,{default:Object(o["fb"])(()=>[0===e.photos.length?(Object(o["J"])(),Object(o["k"])(p,{key:0,description:null})):Object(o["l"])("",!0),(Object(o["J"])(!0),Object(o["m"])(o["b"],null,Object(o["R"])(e.photos,(t,a)=>(Object(o["J"])(),Object(o["k"])(v,{hoverable:"",key:t.id},{cover:Object(o["fb"])(()=>[Object(o["p"])(f,{alt:t.name,preview:{visible:!1},src:e.photoSrc(t),onClick:t=>e.onView(a)},null,8,["alt","src","onClick"])]),actions:Object(o["fb"])(()=>[Object(o["p"])(O,{key:"cover",title:"设为封面",onClick:a=>e.onCover(t)},null,8,["onClick"]),Object(o["p"])(h,{key:"edit",title:"编辑",onClick:a=>e.onEdit(t)},null,8,["onClick"]),Object(o["p"])(m,{title:"您确定要删除这张照片吗？","ok-text":"是","cancel-text":"否",onConfirm:a=>e.onDelete(t)},{default:Object(o["fb"])(()=>[Object(o["p"])(j,{key:"delete",title:"删除照片"})]),_:2},1032,["onConfirm"])]),_:2},1024))),128)),Object(o["n"])("div",l,[Object(o["p"])(g,{preview:e.preview},{default:Object(o["fb"])(()=>[(Object(o["J"])(!0),Object(o["m"])(o["b"],null,Object(o["R"])(e.photos,t=>(Object(o["J"])(),Object(o["k"])(f,{key:t.id,src:e.photoSrc(t)},null,8,["src"]))),128))]),_:1},8,["preview"])]),Object(o["p"])(I,{visible:e.photoInfoDialog.visible,"onUpdate:visible":t[2]||(t[2]=t=>e.photoInfoDialog.visible=t),title:e.photoInfoDialog.title,"confirm-loading":e.photoInfoDialog.confirmLoading,onOk:e.onSavePhoto},{default:Object(o["fb"])(()=>[Object(o["p"])(D,{ref:"formRef",model:e.formData,rules:e.rules,colon:!1,"label-col":{span:3},"wrapper-col":{span:21}},{default:Object(o["fb"])(()=>[Object(o["p"])(w,{label:"名称",name:"name"},{default:Object(o["fb"])(()=>[Object(o["p"])(y,{value:e.formData.name,"onUpdate:value":t[0]||(t[0]=t=>e.formData.name=t),placeholder:"照片名称",size:"large","show-count":"",maxlength:10},null,8,["value"])]),_:1}),Object(o["p"])(w,{label:"描述",name:"description"},{default:Object(o["fb"])(()=>[Object(o["p"])(k,{value:e.formData.description,"onUpdate:value":t[1]||(t[1]=t=>e.formData.description=t),placeholder:"照片描述",rows:4},null,8,["value"])]),_:1}),Object(o["p"])(w,{label:"地址",name:"address"},{default:Object(o["fb"])(()=>[Object(o["p"])(y,{value:e.photoSrc(e.formData),bordered:!1,disabled:!0,placeholder:"照片对象地址"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title","confirm-loading","onOk"])]),_:1})]),_:1})}var n=a("ade3"),i=(a("14d9"),a("9ab4")),r=a("ba98"),b=a("b1c8"),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},u=s,d=a("b3f0");function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},o=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),o.forEach((function(t){f(e,t,a[t])}))}return e}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var O=function(e,t){var a=p({},e,t.attrs);return Object(o["p"])(d["a"],p({},a,{icon:u}),null)};O.displayName="UploadOutlined",O.inheritAttrs=!1;var h=O,j={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M553.1 509.1l-77.8 99.2-41.1-52.4a8 8 0 00-12.6 0l-99.8 127.2a7.98 7.98 0 006.3 12.9H696c6.7 0 10.4-7.7 6.3-12.9l-136.5-174a8.1 8.1 0 00-12.7 0zM360 442a40 40 0 1080 0 40 40 0 10-80 0zm494.6-153.4L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-image",theme:"outlined"},m=j;function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},o=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),o.forEach((function(t){g(e,t,a[t])}))}return e}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var y=function(e,t){var a=v({},e,t.attrs);return Object(o["p"])(d["a"],v({},a,{icon:m}),null)};y.displayName="FileImageOutlined",y.inheritAttrs=!1;var w=y,k=a("ce1f"),D=a("a6a9");class I extends D["a"]{update(e){return super.post("/album-photo/update",e)}deletePhoto(e){return super.get("/album-photo/delete/"+e)}listQuery(e){return super.post("/album-photo/list-query",e)}}const T=new I;var C=T,_=a("7156"),P=a("f64c");let x=class extends k["b"]{constructor(...e){super(...e),Object(n["a"])(this,"formRef",Object(o["P"])()),Object(n["a"])(this,"photos",[]),Object(n["a"])(this,"preview",{visible:!1,current:1,onVisibleChange:e=>{this.preview.visible=e}}),Object(n["a"])(this,"photoInfoDialog",{title:"照片信息",visible:!1,confirmLoading:!1}),Object(n["a"])(this,"formData",{}),Object(n["a"])(this,"rules",{name:[{required:!0,message:"照片名称不能为空"},{max:10,message:"照片名称最多10个字符"}],description:[{max:100,message:"照片描述最多100个字符"}]}),Object(n["a"])(this,"albumId",0)}mounted(){this.albumId=Number(this.$route.query.albumId),this.albumId&&C.listQuery({albumId:this.albumId}).then(e=>{0===e.code?this.photos=e.data:P["a"].error(e.msg)})}onView(e){this.preview.visible=!0,this.preview.current=e}onEdit(e){this.formData={...e},this.photoInfoDialog.visible=!0}onCover(e){const t={cover:e.thumbObjectName,albumId:this.albumId};_["a"].setCover(t).then(t=>{0===t.code?P["a"].success(`照片<${e.name}>已设为相册封面`):P["a"].error(t.msg)})}onDelete(e){C.deletePhoto(e.id).then(t=>{0!==t.code?P["a"].error(t.msg):(P["a"].success("删除成功"),this.photos=this.photos.filter(t=>t.id!==e.id))})}onSavePhoto(){const e=Object(o["ab"])(this.formRef);e&&e.validate().then(async()=>{this.photos.forEach(e=>{e.id===this.formData.id&&C.update(Object(o["X"])(this.formData)).then(t=>{0!==t.code?P["a"].error(t.msg):(e.name=this.formData.name,e.description=this.formData.description,this.photoInfoDialog.visible=!1)})})}).catch(e=>{console.log("error",e)})}handleBack(){this.$router.back()}photoSrc(e){var t;return null!==(t=e.thumbObjectName)&&void 0!==t&&t.startsWith("http")?e.thumbObjectName:"/file/download/"+e.thumbObjectName}beforeUpload(e){var t;const a=e.size/1024/1024<5;return a||P["a"].error("上传照片不能大于 5MB!"),a&&(null===(t=e.type)||void 0===t?void 0:t.startsWith("image/"))}handleUpload(e){if("uploading"===e.file.status)return!1;var t,a;"done"===e.file.status&&(0===(null===(t=e.file.response)||void 0===t?void 0:t.code)?this.photos.push(e.file.response.data):P["a"].error(null===(a=e.file.response)||void 0===a?void 0:a.msg));"error"===e.file.status&&P["a"].error("上传失败")}};x=Object(i["a"])([Object(k["a"])({components:{EditOutlined:r["a"],DeleteOutlined:b["a"],UploadOutlined:h,FileImageOutlined:w}})],x);var z=x,S=(a("5104"),a("6b0d")),V=a.n(S);const U=V()(z,[["render",c],["__scopeId","data-v-82a3913e"]]);t["default"]=U}}]);
//# sourceMappingURL=chunk-aed28342.881885c3.js.map