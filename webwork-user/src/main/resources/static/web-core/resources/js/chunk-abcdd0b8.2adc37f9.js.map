{"version":3,"sources":["webpack:///./src/views/User.vue","webpack:///./src/views/Group.vue","webpack:///./src/request/GroupRequest.ts","webpack:///./src/views/UserForm.vue","webpack:///./src/request/UserRequest.ts","webpack:///./src/views/UserForm.vue?be01","webpack:///./src/views/UserForm.vue?5af4","webpack:///./src/views/GroupForm.vue","webpack:///./node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","webpack:///./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","webpack:///./src/views/GroupForm.vue?71f2","webpack:///./src/views/GroupForm.vue?2159","webpack:///./src/views/Group.vue?0441","webpack:///./src/views/Group.vue?5ef1","webpack:///./src/views/User.vue?2474","webpack:///./src/views/User.vue?a29a","webpack:///./src/views/User.vue?3f7f","webpack:///./node_modules/core-js/modules/es.array.splice.js","webpack:///./src/views/UserForm.vue?0597"],"names":["href","style","class","onSelectGroup","rowKey","columns","data-source","users","rowClassName","pagination","handleTableChange","operation","record","length","title","onUserDel","onUserTop","onUserEdit","filterDropdown","ref","placeholder","column","value","selectedKeys","type","size","handleSearch","confirm","dataIndex","icon","handleReset","clearFilters","filterIcon","filtered","undefined","name","text","searchText","searchedColumn","fragment","i","toLowerCase","key","status","checked","onUserChange","load-data","onLoadData","tree-data","treeData","expandedKeys","draggable","onSelect","onDrop","trigger","overlay","onContextMenuClick","node","$event","contextMenuKeys","ADD_DEPT","ADD_GROUP","UPDATE_GROUP","parentId","DELETE_GROUP","ADD_USER","UPDATE_DEPT","DELETE_DEPT","id","data","params","BaseRequest","request","colon","model","user","rules","label-col","wrapper-col","gutter","span","avatarData","list-type","show-upload-list","action","withCredentials","handleUploadChange","before-upload","beforeUpload","avatar","src","avatarUrl","alt","avatarLoading","prefix","account","password","label","phone","email","post","handleDeptChange","deptName","tree-default-expand-all","dropdown-style","handleUserStatus","onSubmit","onCancel","userId","deptId","pageable","formRef","required","message","max","min","pattern","info","file","response","code","objectName","reavatar","Math","random","error","msg","this","isJpgOrPng","isLt2M","children","ret","toChildren","find","treeNode","Promise","resolve","dataRef","rawId","then","formUnref","validate","formData","add","update","dialog","_ok","catch","console","log","_close","extra","triggerNode","map","isLeaf","selectable","components","UserOutlined","LockOutlined","MobileOutlined","MailOutlined","PlusOutlined","LoadingOutlined","props","Number","String","Object","render","__scopeId","isTop","disabled","parentName","onSelectChange","onSelectTreeExpand","virtual","enabled","_objectWithoutPropertiesLoose","source","excluded","target","sourceKeys","keys","indexOf","_objectWithoutProperties","objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","prototype","propertyIsEnumerable","call","parentType","loadGroupNodes","toAntTreeNodes","TreeNodeType","DEPT","GROUP","nodes","ContextMenuKeys","$emit","e","menuKey","okType","onOk","delete","res","success","loop","item","index","arr","splice","err","$dialog","width","height","content","handle","component","ok","args","parentKey","push","dataToTreeDataItem","oldValue","sort","callback","forEach","dropToGap","dragPos","dragNode","pos","substring","dropKey","dragKey","dropPos","split","dropPosition","dragIndex","dragObj","dropIndex","_item","targetNode","loopParentNode","pNode","dropSort","parent","targetSort","emits","orderMap","ascend","descend","customRender","curr","slots","onFilterDropdownVisibleChange","visible","setTimeout","searchInput","focus","sorter","total","current","pageSize","condition","pageQueryUser","pageList","result","count","pag","filters","sortField","columnKey","sortOrder","order","Array","top","orgcode","Group","SearchOutlined","$","toAbsoluteIndex","toInteger","toLength","toObject","arraySpeciesCreate","createProperty","arrayMethodHasSpeciesSupport","HAS_SPECIES_SUPPORT","MAX_SAFE_INTEGER","MAXIMUM_ALLOWED_LENGTH_EXCEEDED","proto","forced","start","deleteCount","insertCount","actualDeleteCount","A","k","from","to","O","len","actualStart","argumentsLength","arguments","TypeError"],"mappings":"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","file":"resources/js/chunk-abcdd0b8.2adc37f9.js","sourcesContent":["<template>\r\n  <a-layout class=\"a-layout\">\r\n    <a-layout-sider class=\"a-layout-sider\" @contextmenu.prevent>\r\n      <Group @select=\"onSelectGroup\" />\r\n    </a-layout-sider>\r\n    <a-layout-content class=\"a-layout-content\">\r\n      <a-table\r\n        class=\"ant-table-striped\"\r\n        rowKey=\"id\"\r\n        :columns=\"columns\"\r\n        :data-source=\"users\"\r\n        :rowClassName=\"\r\n          (record, index) => (index % 2 === 1 ? 'table-striped' : null)\r\n        \"\r\n        :pagination=\"pagination\"\r\n        @change=\"handleTableChange\"\r\n      >\r\n        <!-- 操作列模板 -->\r\n        <template #operation=\"{ record }\">\r\n          <a-space>\r\n            <a-popconfirm\r\n              v-if=\"users.length\"\r\n              title=\"您确定要删除吗?\"\r\n              @confirm=\"onUserDel(record)\"\r\n            >\r\n              <a href=\"javascript:void(0);\">删除</a>\r\n            </a-popconfirm>\r\n            <a href=\"javascript:void(0);\" @click=\"onUserTop(record)\">置顶</a>\r\n            <a href=\"javascript:void(0);\" @click=\"onUserEdit(record)\">编辑</a>\r\n          </a-space>\r\n        </template>\r\n        <!-- 自定义筛选菜单 -->\r\n        <template\r\n          #filterDropdown=\"{\r\n            setSelectedKeys,\r\n            selectedKeys,\r\n            confirm,\r\n            clearFilters,\r\n            column\r\n          }\"\r\n        >\r\n          <div style=\"padding: 8px\">\r\n            <a-input\r\n              ref=\"searchInput\"\r\n              :placeholder=\"`搜索 ${column.title}`\"\r\n              :value=\"selectedKeys[0]\"\r\n              style=\"width: 188px; margin-bottom: 8px; display: block\"\r\n              @change=\"\r\n                (e) => setSelectedKeys(e.target.value ? [e.target.value] : [])\r\n              \"\r\n              @pressEnter=\"\r\n                handleSearch(selectedKeys, confirm, column.dataIndex)\r\n              \"\r\n            />\r\n            <a-button\r\n              type=\"primary\"\r\n              size=\"small\"\r\n              style=\"width: 90px; margin-right: 8px\"\r\n              @click=\"handleSearch(selectedKeys, confirm, column.dataIndex)\"\r\n            >\r\n              <template #icon><SearchOutlined /></template>\r\n              Search\r\n            </a-button>\r\n            <a-button\r\n              size=\"small\"\r\n              style=\"width: 90px\"\r\n              @click=\"handleReset(clearFilters)\"\r\n            >\r\n              Reset\r\n            </a-button>\r\n          </div>\r\n        </template>\r\n        <template #filterIcon=\"filtered\">\r\n          <search-outlined\r\n            :style=\"{ color: filtered ? '#108ee9' : undefined }\"\r\n          />\r\n        </template>\r\n        <template #name=\"{ text, column }\">\r\n          <span v-if=\"searchText && searchedColumn === column.dataIndex\">\r\n            <template\r\n              v-for=\"(fragment, i) in text\r\n                .toString()\r\n                .split(new RegExp(`(?<=${searchText})|(?=${searchText})`, 'i'))\"\r\n            >\r\n              <mark\r\n                v-if=\"fragment.toLowerCase() === searchText.toLowerCase()\"\r\n                class=\"highlight\"\r\n                :key=\"i\"\r\n              >\r\n                {{ fragment }}\r\n              </mark>\r\n              <template v-else>{{ fragment }}</template>\r\n            </template>\r\n          </span>\r\n          <template v-else>\r\n            {{ text }}\r\n          </template>\r\n        </template>\r\n        <!-- 用户状态 -->\r\n        <template #status=\"{record}\">\r\n          <a-switch :checked=\"record.status == 1\" @click=\"onUserChange(record)\" />\r\n        </template>\r\n      </a-table>\r\n    </a-layout-content>\r\n  </a-layout>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { ref, unref } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport { SearchOutlined } from '@ant-design/icons-vue'\r\nimport { SelectEvent } from 'ant-design-vue/es/tree/Tree'\r\nimport { TableState, TableStateFilters } from 'ant-design-vue/es/table/interface'\r\nimport { User } from '@/types/User'\r\nimport Group from './Group.vue'\r\nimport UserForm from './UserForm.vue'\r\nimport Pageable from '@/types/Pageable'\r\nimport request from '@/request/UserRequest'\r\n// 分页数据类型\r\ntype Pagination = TableState['pagination'];\r\n// 排序映射\r\nconst orderMap: {[key: string]: string} = {\r\n  ascend: 'ASC',\r\n  descend: 'DESC'\r\n}\r\n@Options({\r\n  components: {\r\n    Group,\r\n    SearchOutlined\r\n  }\r\n})\r\nexport default class VueUser extends Vue {\r\n  // 用户列定义\r\n  columns = [\r\n    {\r\n      title: '序号',\r\n      dataIndex: 'number',\r\n      width: 100,\r\n      customRender: (info: {\r\n        text: string;\r\n        record: User;\r\n        index: number;\r\n      }) => {\r\n        return (this.pageable.curr - 1) * this.pageable.size + info.index + 1\r\n      }\r\n    },\r\n    {\r\n      title: '姓名',\r\n      dataIndex: 'name',\r\n      slots: {\r\n        filterDropdown: 'filterDropdown',\r\n        filterIcon: 'filterIcon',\r\n        customRender: 'name'\r\n      },\r\n      onFilterDropdownVisibleChange: (visible: boolean) => {\r\n        if (visible) {\r\n          setTimeout(() => {\r\n            const searchInput = unref(this.searchInput)\r\n            searchInput && searchInput.focus()\r\n          }, 0)\r\n        }\r\n      }\r\n    },\r\n    { title: '账号', dataIndex: 'account' },\r\n    { title: '手机', dataIndex: 'phone', width: 200 },\r\n    { title: '邮箱', dataIndex: 'email', width: 200 },\r\n    { title: '更新时间', dataIndex: 'updateTime', width: 200, sorter: true, key: 'update_time' },\r\n    {\r\n        title: '状态',\r\n        width: 100,\r\n        dataIndex: 'status',\r\n        slots: { customRender: 'status' }\r\n    },\r\n    {\r\n      title: '操作',\r\n      dataIndex: 'operation',\r\n      width: 200,\r\n      slots: { customRender: 'operation' }\r\n    }\r\n  ]\r\n\r\n  // 表格数据\r\n  users: User[] = []\r\n\r\n  // 搜索\r\n  searchInput = ref<HTMLInputElement>()\r\n  searchText = ''\r\n  searchedColumn = ''\r\n\r\n  // 分页参数定义\r\n  pagination = {\r\n    total: 200,\r\n    current: 1,\r\n    pageSize: 10\r\n  }\r\n\r\n  // 分页条件\r\n  pageable: Pageable = {\r\n    curr: this.pagination.current,\r\n    size: this.pagination.pageSize,\r\n    condition: {}\r\n  }\r\n\r\n  mounted() {\r\n    this.pageQueryUser()\r\n  }\r\n\r\n  // 分页查询用户\r\n  async pageQueryUser() {\r\n    const result = await request.pageList(this.pageable)\r\n    if (result.code === 0) {\r\n      this.users = result.data.data\r\n      this.pagination.total = result.data.count\r\n    } else {\r\n      message.error(result.msg)\r\n    }\r\n  }\r\n\r\n  // 表格变动监听\r\n  handleTableChange(pag: Pagination, filters: TableStateFilters, sorter: {field: string; order: string; columnKey: string}) {\r\n      this.pagination.current = pag?.current || 1\r\n      this.pageable.curr = this.pagination.current\r\n      this.pageable.sortField = sorter.columnKey || ''\r\n      this.pageable.sortOrder = orderMap[sorter.order] || ''\r\n      this.pageable.condition.name = (filters.name instanceof Array ? filters.name[0] : '')\r\n      this.pageQueryUser()\r\n  }\r\n\r\n  /** 列表搜索 */\r\n  handleSearch(selectedKeys: string[], confirm: Function, dataIndex: string) {\r\n    confirm()\r\n    this.searchText = selectedKeys[0] || ''\r\n    this.searchedColumn = dataIndex\r\n  }\r\n\r\n  /** 查询条件重置 */\r\n  handleReset(clearFilters: Function) {\r\n    clearFilters()\r\n    this.searchText = ''\r\n  }\r\n\r\n  /** 删除人员 */\r\n  async onUserDel(user: User) {\r\n    const ret = await request.delete(user.id as number)\r\n    if (ret.code === 0) {\r\n      this.pageQueryUser()\r\n    } else {\r\n      message.error(`删除失败:${ret.msg}`)\r\n    }\r\n  }\r\n\r\n  // 编辑人员\r\n  onUserEdit(user: User) {\r\n    this.$dialog({\r\n      title: '用户信息',\r\n      width: 550,\r\n      height: 650,\r\n      max: false,\r\n      content: {\r\n        handle: true,\r\n        component: UserForm,\r\n        props: { id: user.id, deptId: user.deptId }\r\n      },\r\n      ok: () => {\r\n        this.pageQueryUser()\r\n        return true\r\n      }\r\n    })\r\n  }\r\n\r\n  // 人员置顶\r\n  async onUserTop(user: User) {\r\n    const ret = await request.top(user.id as number, user.deptId as number)\r\n    if (ret.code === 0) {\r\n      this.pageQueryUser()\r\n    } else {\r\n      message.error(`置顶失败:${ret.msg}`)\r\n    }\r\n  }\r\n\r\n  userStatus(user: User) {\r\n    return user.status === 1\r\n  }\r\n\r\n  /** 改变用户状态 */\r\n  async onUserChange(user: User) {\r\n    user.status = user.status === 1 ? 0 : 1\r\n    const ret = await request.update(user)\r\n    if (ret.code !== 0) {\r\n      message.error(ret.msg)\r\n      user.status = user.status === 1 ? 0 : 1\r\n    }\r\n  }\r\n\r\n  // 节点选择\r\n  onSelectGroup(selectedKeys: string[], info: SelectEvent) {\r\n    // console.log(selectedKeys, info)\r\n    this.pageable.condition.orgcode = info.node.dataRef.code\r\n    this.pageQueryUser()\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n.a-layout {\r\n  height: 100%;\r\n}\r\n.a-layout-sider {\r\n  width: 250px;\r\n  overflow: auto;\r\n  background-color: #fff;\r\n}\r\n.a-layout-content {\r\n  padding: 5px 2px;\r\n  overflow: auto;\r\n}\r\n.highlight {\r\n  background-color: rgb(255, 192, 105);\r\n  padding: 0px;\r\n}\r\n</style>\r\n","<template >\r\n  <a-tree\r\n    :load-data=\"onLoadData\"\r\n    :tree-data=\"treeData\"\r\n    v-model:expandedKeys=\"expandedKeys\"\r\n    draggable\r\n    @select=\"onSelect\"\r\n    style=\"height: 100%\"\r\n    @contextmenu.prevent\r\n    @drop=\"onDrop\"\r\n  >\r\n    <template #title=\"node\">\r\n      <a-dropdown :trigger=\"['contextmenu']\">\r\n        <span @contextmenu.prevent>{{ node.title }}</span>\r\n        <template #overlay>\r\n          <a-menu\r\n            @click=\"onContextMenuClick(node, $event)\"\r\n          >\r\n            <!-- 单位菜单 -->\r\n            <template v-if=\"node.type == 0 || node.type == 1\">\r\n              <a-menu-item :key=\"contextMenuKeys.ADD_DEPT\"\r\n                >新增部门</a-menu-item\r\n              >\r\n              <a-menu-item :key=\"contextMenuKeys.ADD_GROUP\"\r\n                >新增单位</a-menu-item\r\n              >\r\n              <a-menu-item :key=\"contextMenuKeys.UPDATE_GROUP\"\r\n                >更新单位</a-menu-item\r\n              >\r\n              <!-- 根节点不可删除 -->\r\n              <a-menu-item v-if=\"node.parentId != null\" :key=\"contextMenuKeys.DELETE_GROUP\">\r\n                删除单位\r\n              </a-menu-item>\r\n            </template>\r\n            <!-- 部门菜单 -->\r\n            <template v-if=\"node.type == 2\">\r\n              <a-menu-item :key=\"contextMenuKeys.ADD_USER\"\r\n                >新增人员</a-menu-item\r\n              >\r\n              <a-menu-item :key=\"contextMenuKeys.UPDATE_DEPT\"\r\n                >更新部门</a-menu-item\r\n              >\r\n              <a-menu-item :key=\"contextMenuKeys.DELETE_DEPT\"\r\n                >删除部门</a-menu-item\r\n              >\r\n            </template>\r\n          </a-menu>\r\n        </template>\r\n      </a-dropdown>\r\n    </template>\r\n  </a-tree>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { TreeDataItem, SelectEvent } from 'ant-design-vue/es/tree/Tree'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport { message, Modal } from 'ant-design-vue'\r\nimport request from '@/request/GroupRequest'\r\nimport { R } from '@/types/R'\r\nimport { Group } from '@/types/Group'\r\nimport { TreeNode } from '@/types/TreeNode'\r\nimport UserForm from './UserForm.vue'\r\nimport GroupForm from './GroupForm.vue'\r\nimport { TreeNodeType } from '@/types/TreeNodeType'\r\n// 右键菜单键\r\nenum ContextMenuKeys {\r\n  // 新增人员\r\n  ADD_USER,\r\n  // 添加部门\r\n  ADD_DEPT,\r\n  // 添加单位\r\n  ADD_GROUP,\r\n  // 更新部门\r\n  UPDATE_DEPT,\r\n  // 更新单位\r\n  UPDATE_GROUP,\r\n  // 删除部门\r\n  DELETE_DEPT,\r\n  // 删除单位\r\n  DELETE_GROUP\r\n}\r\n\r\n/**\r\n * 组织机构管理\r\n */\r\n@Options({\r\n  emits: ['select']\r\n})\r\nexport default class GroupVue extends Vue {\r\n  // 组织树数据源\r\n  treeData: TreeDataItem[] = []\r\n  // 展开的KEY\r\n  expandedKeys: string[] = []\r\n  // 右键菜单枚举\r\n  contextMenuKeys = ContextMenuKeys\r\n  /**\r\n   * 页面挂载后\r\n   */\r\n  async mounted() {\r\n    // 加载组织机构根节点\r\n    const ret = await request.children()\r\n    if (ret.code !== 0) {\r\n      message.error(ret.msg)\r\n      return false\r\n    }\r\n    this.treeData = this.toChildren(ret)\r\n  }\r\n\r\n  /**\r\n   * 加载节点数据\r\n   */\r\n  onLoadData(treeNode: TreeDataItem) {\r\n    return new Promise((resolve: (value?: unknown) => void) => {\r\n      if (treeNode.dataRef.children) {\r\n        resolve()\r\n        return false\r\n      }\r\n      request.children(treeNode.dataRef.rawId as number).then((ret) => {\r\n        treeNode.dataRef.children = this.toChildren(ret)\r\n        this.treeData = [...this.treeData]\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  // 节点点击事件\r\n  onSelect(selectedKeys: string[], info: SelectEvent) {\r\n    this.$emit('select', selectedKeys, info)\r\n  }\r\n\r\n  // 右键菜单\r\n  onContextMenuClick(node: TreeDataItem, e: { key: ContextMenuKeys; [key: string]: any }) {\r\n    const menuKey = e.key\r\n    let title\r\n    let formData: {\r\n      id?: number; // rawId\r\n      type: number; // enum NodeType\r\n      parentId?: number; // 父节点ID\r\n      parentType?: number; // 父节点类型\r\n      parentName?: string; // 父节点名称\r\n    }\r\n    if (ContextMenuKeys.ADD_DEPT === menuKey) {\r\n      title = '新增部门'\r\n      formData = {\r\n        type: TreeNodeType.DEPT,\r\n        parentId: node.rawId,\r\n        parentType: node.type,\r\n        parentName: node.title\r\n      }\r\n    } else if (ContextMenuKeys.ADD_GROUP === menuKey) {\r\n      title = '新增单位'\r\n      formData = {\r\n        type: TreeNodeType.GROUP,\r\n        parentId: node.rawId,\r\n        parentType: node.type,\r\n        parentName: node.title\r\n      }\r\n    } else if (ContextMenuKeys.UPDATE_DEPT === menuKey) {\r\n      title = '更新部门'\r\n      formData = {\r\n        id: node.rawId,\r\n        type: TreeNodeType.DEPT\r\n      }\r\n    } else if (ContextMenuKeys.UPDATE_GROUP === menuKey) {\r\n      title = '更新单位'\r\n      formData = {\r\n        id: node.rawId,\r\n        type: TreeNodeType.GROUP\r\n      }\r\n    } else if (\r\n      ContextMenuKeys.DELETE_DEPT === menuKey ||\r\n      ContextMenuKeys.DELETE_GROUP === menuKey\r\n    ) {\r\n      Modal.confirm({\r\n        title: `您确定要删除<${node.title}>吗?`,\r\n        okType: 'danger',\r\n        onOk: () => {\r\n          request\r\n            .delete(node.rawId)\r\n            .then((res) => {\r\n              if (res.code === 0) {\r\n                message.success('删除成功')\r\n                this.loop(\r\n                  this.treeData,\r\n                  node.key as string,\r\n                  (item, index, arr) => {\r\n                    arr.splice(index, 1)\r\n                  }\r\n                )\r\n              } else {\r\n                message.error('删除失败:' + res.msg)\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              message.error(err.message)\r\n            })\r\n        }\r\n      })\r\n\r\n      return false\r\n    } else if (ContextMenuKeys.ADD_USER === menuKey) {\r\n      this.$dialog({\r\n        title: '新增用户',\r\n        width: 550,\r\n        height: 650,\r\n        max: false,\r\n        content: {\r\n          handle: true,\r\n          component: UserForm,\r\n          props: { deptId: node.rawId, deptName: node.title }\r\n        },\r\n        ok: () => {\r\n            this.$emit('select', [node.key], {\r\n                node: {\r\n                    dataRef: {\r\n                        code: node.code\r\n                    }\r\n                }\r\n            })\r\n            return true\r\n        }\r\n      })\r\n      return false\r\n    } else {\r\n      console.log(`unknow menukey ${menuKey}`)\r\n      return false\r\n    }\r\n    this.$dialog({\r\n      title: title,\r\n      width: 550,\r\n      height: 400,\r\n      content: {\r\n        handle: true,\r\n        props: formData,\r\n        component: GroupForm\r\n      },\r\n      ok: (args: unknown[]) => {\r\n        const data = args[0] as Group\r\n        const key = `${data.type}_${data.id}`\r\n        const parentKey = `${formData.parentType}_${formData.parentId}`\r\n        const treeNode = {\r\n                            id: key,\r\n                            rawId: data.id,\r\n                            type: data.type,\r\n                            name: data.name,\r\n                            code: data.code\r\n                          } as TreeNode\r\n        if (node.key === key) {\r\n          // 更新节点名称\r\n          node.dataRef.title = data.name\r\n        } else if (node.key === parentKey) {\r\n          // 当前节点下新增\r\n          if (node.dataRef.children) {\r\n            node.dataRef.children.push(this.dataToTreeDataItem(treeNode))\r\n          } else {\r\n            this.onLoadData(node)\r\n          }\r\n        } else {\r\n          // 非当前节点下新增\r\n          this.loop(\r\n            this.treeData,\r\n            parentKey,\r\n            (item, index, arr) => {\r\n              item.children && item.children.push(this.dataToTreeDataItem(treeNode))\r\n            }\r\n          )\r\n        }\r\n        return true\r\n      }\r\n    })\r\n  }\r\n\r\n  // 属性监听\r\n  watchExpandedKeys(value: string[], oldValue: string[]) {\r\n    console.log('expandedKeys', value, oldValue)\r\n  }\r\n\r\n  // 转为树节点类型\r\n  toChildren(ret: R<TreeNode[]>) {\r\n    return ret.data.map((value) => {\r\n      return this.dataToTreeDataItem(value)\r\n    })\r\n  }\r\n\r\n  // 数据转树节点\r\n  dataToTreeDataItem(data: TreeNode) {\r\n    return {\r\n      key: data.id,\r\n      type: data.type,\r\n      title: data.name,\r\n      code: data.code,\r\n      rawId: data.rawId,\r\n      sort: data.sort,\r\n      parentId: data.parentId,\r\n      isLeaf: data.type === TreeNodeType.DEPT\r\n    } as TreeDataItem\r\n  }\r\n\r\n  // 查询树节点\r\n  loop(\r\n    data: TreeDataItem[],\r\n    key: string,\r\n    callback: (item: TreeDataItem, index: number, arr: TreeDataItem[]) => void\r\n  ) {\r\n    data.forEach((item, index, arr) => {\r\n      if (item.key === key) {\r\n        return callback(item, index, arr)\r\n      }\r\n      if (item.children) {\r\n        return this.loop(item.children, key, callback)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 拖拽排序\r\n  onDrop(info: { node: TreeDataItem; dragNode: TreeDataItem; dropToGap: boolean; dropPosition: number; [key: string]: any }) {\r\n    // console.log(info)\r\n    // 忽略拖入节点内的操作\r\n    if (!info.dropToGap) {\r\n      return false\r\n    }\r\n    // 只能同一层级内拖拽\r\n    const dragPos = info.dragNode.pos as string\r\n    if (info.node.pos.substring(0, info.node.pos.length - 1) !== dragPos.substring(0, dragPos.length - 1)) {\r\n      return false\r\n    }\r\n    const dropKey = info.node.dataRef.key as string\r\n    const dragKey = info.dragNode.dataRef.key as string\r\n    const dropPos = info.node.pos.split('-')\r\n    const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1])\r\n\r\n    // Find dragObject\r\n    let dragIndex = 0\r\n    let dragObj: TreeDataItem = {}\r\n    this.loop(this.treeData, dragKey, (item: TreeDataItem, index: number, arr: TreeDataItem[]) => {\r\n      arr.splice(index, 1)\r\n      dragObj = item\r\n      dragIndex = index\r\n    })\r\n\r\n    let dropIndex = 0\r\n    let nodes: TreeDataItem[] = []\r\n    this.loop(this.treeData, dropKey, (_item: TreeDataItem, index: number, arr: TreeDataItem[]) => {\r\n      nodes = arr\r\n      dropIndex = index\r\n    })\r\n    // debugger\r\n    if (dropPosition === -1) {\r\n      nodes.splice(dropIndex, 0, dragObj)\r\n    } else {\r\n      nodes.splice(dropIndex + 1, 0, dragObj)\r\n    }\r\n\r\n    // 重新查找拖拽节点, 向上拖拽取下节点，向下拖拽取上节点\r\n    let targetNode: TreeDataItem = {}\r\n    this.loop(this.treeData, dragKey, (item: TreeDataItem, index: number, arr: TreeDataItem[]) => {\r\n      if (index < dragIndex) {\r\n        targetNode = arr[index + 1]\r\n      } else if (index > dragIndex) {\r\n        targetNode = arr[index - 1]\r\n      }\r\n    })\r\n    if (!targetNode.key) {\r\n      return false\r\n    }\r\n    // 获取父节点ID\r\n    let parentId\r\n    this.loopParentNode(dragKey, {}, this.treeData, (pNode: TreeDataItem) => {\r\n      parentId = pNode.rawId\r\n    })\r\n    const dropSort = {\r\n      parent: parentId,\r\n      sort: dragObj.sort,\r\n      targetSort: targetNode.sort\r\n    }\r\n    request.dropSort(dropSort).then(ret => {\r\n      console.log(ret.code, ret.msg, ret.data)\r\n    })\r\n    return false\r\n  }\r\n\r\n  // 查询父节点\r\n  loopParentNode(key: string, pNode: TreeDataItem, children: TreeDataItem[], callback: (pNode: TreeDataItem) => void) {\r\n    children.forEach((item, index, arr) => {\r\n      if (key === item.key) {\r\n        return callback(pNode)\r\n      }\r\n      if (item.children) {\r\n        this.loopParentNode(key, item, item.children, callback)\r\n      }\r\n    })\r\n  }\r\n}\r\n</script>\r\n","import { Group } from '@/types/Group'\r\nimport { TreeNode } from '@/types/TreeNode'\r\nimport BaseRequest from './BaseRequest'\r\n\r\n/** 组织机构接口请求 */\r\nexport class GroupRequest extends BaseRequest {\r\n    /** 根据ID查询组织 */\r\n    find(id: number) {\r\n        return super.get<Group>(`/organization/get/${id}`)\r\n    }\r\n\r\n    /** 根据ID删除组织 */\r\n    delete(id: number) {\r\n        return super.get(`/organization/delete/${id}`)\r\n    }\r\n\r\n    /** 添加组织机构 */\r\n    add(data: Group) {\r\n        return super.post('/organization/add', data)\r\n    }\r\n\r\n    /** 更新组织机构 */\r\n    update(data: Group) {\r\n        return super.post('/organization/update', data)\r\n    }\r\n\r\n    /** 加载当前用户的单位树数据 */\r\n    loadGroupNodes() {\r\n        return super.get<TreeNode[]>('/organization/load-nodes')\r\n    }\r\n\r\n    /** 查询组织机构子节点  */\r\n    children(parentId?: number) {\r\n        return super.get<TreeNode[]>('/organization/children' + (parentId ? `?parentId=${parentId}` : ''))\r\n    }\r\n\r\n    /** 拖动排序 */\r\n    dropSort(params: {parent: any; sort: number; targetSort: number}) {\r\n        return super.post<boolean>('/organization/drop-sort', params)\r\n    }\r\n}\r\n\r\nconst request = new GroupRequest()\r\nexport default request\r\n","<template>\r\n  <a-form\r\n    ref=\"formRef\"\r\n    :colon=\"false\"\r\n    :model=\"user\"\r\n    :rules=\"rules\"\r\n    :label-col=\"{ span: 4 }\"\r\n    :wrapper-col=\"{ span: 18 }\"\r\n  >\r\n    <a-row type=\"flex\" :gutter=\"8\" style=\"margin: 0px\">\r\n      <a-col :span=\"4\"></a-col>\r\n      <a-col :span=\"6\">\r\n        <a-upload\r\n          name=\"file\"\r\n          :data=\"avatarData\"\r\n          list-type=\"picture-card\"\r\n          class=\"avatar-uploader\"\r\n          :show-upload-list=\"false\"\r\n          action=\"/file/upload\"\r\n          :withCredentials=\"true\"\r\n          @change=\"handleUploadChange\"\r\n          :before-upload=\"beforeUpload\"\r\n        >\r\n          <img v-if=\"user.avatar\" :src=\"avatarUrl\" alt=\"头像\" />\r\n          <div v-else>\r\n            <loading-outlined v-if=\"avatarLoading\"></loading-outlined>\r\n            <plus-outlined v-else></plus-outlined>\r\n            <div class=\"ant-upload-text\">Upload</div>\r\n          </div>\r\n        </a-upload>\r\n      </a-col>\r\n      <a-col :span=\"12\">\r\n        <a-form-item :wrapper-col=\"{ flex: 'auto' }\" name=\"name\">\r\n          <a-input v-model:value=\"user.name\" placeholder=\"姓名\">\r\n            <template #prefix\r\n              ><UserOutlined style=\"color: rgba(0, 0, 0, 0.25)\"\r\n            /></template>\r\n          </a-input>\r\n        </a-form-item>\r\n        <a-form-item :wrapper-col=\"{ flex: 'auto' }\" name=\"account\">\r\n          <a-input v-model:value=\"user.account\" placeholder=\"账号\">\r\n            <template #prefix\r\n              ><UserOutlined style=\"color: rgba(0, 0, 0, 0.25)\"\r\n            /></template>\r\n          </a-input>\r\n        </a-form-item>\r\n        <a-form-item :wrapper-col=\"{ flex: 'auto' }\" name=\"password\">\r\n          <a-input\r\n            v-model:value=\"user.password\"\r\n            type=\"password\"\r\n            placeholder=\"密码\"\r\n          >\r\n            <template #prefix\r\n              ><LockOutlined style=\"color: rgba(0, 0, 0, 0.25)\"\r\n            /></template>\r\n          </a-input>\r\n        </a-form-item>\r\n      </a-col>\r\n    </a-row>\r\n\r\n    <a-form-item label=\"手机\" name=\"phone\">\r\n      <a-input v-model:value=\"user.phone\" placeholder=\"手机\">\r\n        <template #prefix\r\n          ><MobileOutlined style=\"color: rgba(0, 0, 0, 0.25)\"\r\n        /></template>\r\n      </a-input>\r\n    </a-form-item>\r\n    <a-form-item label=\"邮箱\" name=\"email\">\r\n      <a-input v-model:value=\"user.email\" placeholder=\"邮箱\">\r\n        <template #prefix\r\n          ><MailOutlined style=\"color: rgba(0, 0, 0, 0.25)\"\r\n        /></template>\r\n      </a-input>\r\n    </a-form-item>\r\n    <a-form-item label=\"职务\">\r\n      <a-input v-model:value=\"user.post\" placeholder=\"职务\">\r\n        <template #prefix\r\n          ><UserOutlined style=\"color: rgba(0, 0, 0, 0.25)\"\r\n        /></template>\r\n      </a-input>\r\n    </a-form-item>\r\n    <a-form-item label=\"部门\">\r\n      <a-tree-select\r\n        :tree-data=\"treeData\"\r\n        :load-data=\"onLoadData\"\r\n        @change=\"handleDeptChange\"\r\n        v-model:value=\"user.deptName\"\r\n        tree-default-expand-all\r\n        style=\"width: 100%\"\r\n        placeholder=\"请选择用户部门\"\r\n        :dropdown-style=\"{ maxHeight: '400px', overflow: 'auto' }\"\r\n      />\r\n    </a-form-item>\r\n    <a-form-item label=\"状态\">\r\n      <a-switch :checked=\"user.status == 1\" @click=\"handleUserStatus\" />\r\n    </a-form-item>\r\n    <a-form-item :wrapper-col=\"{ span: 14, offset: 4 }\">\r\n      <a-button type=\"primary\" @click=\"onSubmit\">保存</a-button>\r\n      <a-button style=\"margin-left: 10px\" @click=\"onCancel\">取消</a-button>\r\n    </a-form-item>\r\n  </a-form>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { PropType, ref, toRaw, unref } from 'vue'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport {\r\n  UserOutlined,\r\n  LockOutlined,\r\n  MobileOutlined,\r\n  MailOutlined,\r\n  PlusOutlined,\r\n  LoadingOutlined\r\n} from '@ant-design/icons-vue'\r\nimport { User } from '@/types/User'\r\nimport Dialog from '@/components/Dialog.vue'\r\nimport { ValidateErrorEntity } from 'ant-design-vue/es/form/interface'\r\nimport request from '@/request/UserRequest'\r\nimport GroupRequest from '@/request/GroupRequest'\r\nimport { message } from 'ant-design-vue'\r\nimport { TreeDataItem } from 'ant-design-vue/es/tree/Tree'\r\nimport { R } from '@/types/R'\r\nimport { TreeNode } from '@/types/TreeNode'\r\n\r\ninterface FileItem {\r\n  uid: string;\r\n  name?: string;\r\n  status?: string;\r\n  response?: R<any>;\r\n  url?: string;\r\n  type?: string;\r\n  size: number;\r\n  originFileObj: any;\r\n}\r\n\r\ninterface FileInfo {\r\n  file: FileItem;\r\n  fileList: FileItem[];\r\n}\r\n\r\n@Options({\r\n  components: {\r\n    UserOutlined,\r\n    LockOutlined,\r\n    MobileOutlined,\r\n    MailOutlined,\r\n    PlusOutlined,\r\n    LoadingOutlined\r\n  },\r\n  props: {\r\n    id: {\r\n      type: Number\r\n    },\r\n    deptId: {\r\n      type: Number\r\n    },\r\n    deptName: {\r\n      type: String\r\n    },\r\n    dialog: Object as PropType<Dialog>\r\n  }\r\n})\r\nexport default class UserForm extends Vue {\r\n  // 当前弹框\r\n  dialog!: Dialog\r\n  // 用户ID\r\n  id!: number\r\n  // 部门\r\n  deptId!: number\r\n  deptName!: string\r\n  // 用户对象数据\r\n  user: User = {\r\n    status: 1,\r\n    deptId: this.deptId,\r\n    deptName: this.deptName\r\n  }\r\n\r\n  // 头像上传标志\r\n  avatarLoading = false\r\n  // 组织树数据源\r\n  treeData: TreeDataItem[] = []\r\n  // 表单引用\r\n  formRef = ref<AntType.Form>()\r\n  // 验证规则\r\n  rules = {\r\n    name: [{ required: true, message: '请输入姓名', trigger: 'blur' }, { max: 20, message: '最多输入20个字符' }],\r\n    account: [{ required: true, message: '请输入账号', trigger: 'blur' }, { max: 20, message: '最多输入20个字符' }],\r\n    post: [{ max: 20, message: '最多输入20个字符' }],\r\n    password: [\r\n      { required: false, message: '请输入密码', trigger: 'blur' },\r\n      { min: 6, max: 15, message: '密码为6-15位字符串', trigger: 'blur' }\r\n    ],\r\n    phone: [\r\n      { max: 11, message: '手机号最多为11个数字', trigger: 'blur' },\r\n      { pattern: /^1[0-9]{10}$/, message: '手机号码错误', trigger: 'blur' }\r\n    ],\r\n    email: [\r\n      {\r\n        pattern: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)*(\\.[a-z]{2,})$/,\r\n        message: '邮箱地址错误',\r\n        trigger: 'blur'\r\n      },\r\n      { max: 50, message: '最多输入50个字符' }\r\n    ]\r\n  }\r\n\r\n  // 用户头像地址\r\n  get avatarUrl() {\r\n    // 更换头像\r\n    if (this.user.reavatar) {\r\n      return `/file/download/thumb/${this.user.reavatar}`\r\n    } else {\r\n      return `/file/download/thumb/${this.user.avatar}`\r\n    }\r\n  }\r\n\r\n  // 上传头像数据\r\n  get avatarData() {\r\n    return { objectName: this.user.avatar || '' }\r\n  }\r\n\r\n  // 头像上传前回调\r\n  beforeUpload(file: FileItem) {\r\n    const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'\r\n    if (!isJpgOrPng) {\r\n      message.error('You can only upload JPG file!')\r\n    }\r\n    const isLt2M = file.size / 1024 / 1024 < 2\r\n    if (!isLt2M) {\r\n      message.error('Image must smaller than 2MB!')\r\n    }\r\n    return isJpgOrPng && isLt2M\r\n  }\r\n\r\n  // 上传事件\r\n  handleUploadChange = (info: FileInfo) => {\r\n    if (info.file.status === 'uploading') {\r\n      this.avatarLoading = true\r\n      return false\r\n    }\r\n    this.avatarLoading = false\r\n    if (info.file.status === 'done') {\r\n      if (info.file.response?.code === 0) {\r\n        this.user.avatar = info.file.response.data.objectName\r\n        this.user.reavatar = this.user.avatar + '?random=' + Math.random()\r\n      } else {\r\n        message.error(info.file.response?.msg as string)\r\n      }\r\n    }\r\n    if (info.file.status === 'error') {\r\n      message.error('上传失败')\r\n    }\r\n  }\r\n\r\n  // 挂载后执行\r\n  async mounted() {\r\n    // 加载组织树数据\r\n    const ret = await GroupRequest.children()\r\n    if (ret.code === 0) {\r\n      this.treeData = this.toChildren(ret)\r\n    } else {\r\n      message.error(ret.msg)\r\n    }\r\n    // 加载用户信息\r\n    if (this.id) {\r\n      const ret = await request.find(this.id)\r\n      if (ret.code === 0) {\r\n          this.user = ret.data\r\n        } else {\r\n          message.error(ret.msg)\r\n        }\r\n    } else {\r\n      // 新增用户需要校验密码\r\n      this.rules.password[0].required = true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 加载节点数据\r\n   */\r\n  onLoadData(treeNode: { dataRef: TreeDataItem }) {\r\n    return new Promise((resolve: (value?: unknown) => void) => {\r\n      if (treeNode.dataRef.children) {\r\n        resolve()\r\n        return false\r\n      }\r\n      GroupRequest.children(treeNode.dataRef.rawId as number).then((ret) => {\r\n        treeNode.dataRef.children = this.toChildren(ret)\r\n        this.treeData = [...this.treeData]\r\n        resolve()\r\n        this.user.deptId = this.user.deptId || 0\r\n      })\r\n    })\r\n  }\r\n\r\n  // 保存\r\n  onSubmit() {\r\n    const formUnref = unref(this.formRef)\r\n    formUnref &&\r\n      formUnref\r\n        .validate()\r\n        .then(async () => {\r\n          let ret\r\n          const formData = toRaw(this.user)\r\n          if (!this.user.id) {\r\n            ret = await request.add(formData)\r\n          } else {\r\n            ret = await request.update(formData)\r\n          }\r\n          if (ret.code === 0) {\r\n            this.dialog._ok()\r\n          } else {\r\n            message.error(ret.msg)\r\n          }\r\n        })\r\n        .catch((error: ValidateErrorEntity<User>) => {\r\n          console.log('error', error)\r\n        })\r\n  }\r\n\r\n  // 取消\r\n  onCancel() {\r\n    this.dialog._close()\r\n  }\r\n\r\n  // 用户状态切换\r\n  handleUserStatus() {\r\n    this.user.status = this.user.status === 1 ? 0 : 1\r\n  }\r\n\r\n  // 切换用户部门\r\n  handleDeptChange(value: any, label: any, extra: any) {\r\n    // console.log('选择部门', extra.triggerNode.dataRef)\r\n    this.user.deptId = extra.triggerNode.dataRef.rawId\r\n  }\r\n\r\n  // 转为树节点类型\r\n  toChildren(ret: R<TreeNode[]>) {\r\n    return ret.data.map((value) => {\r\n      return {\r\n        key: value.id,\r\n        rawId: value.rawId,\r\n        type: value.type, // 节点类型 0虚拟节点 1组织 2部门\r\n        value: value.id,\r\n        title: value.name,\r\n        code: value.code,\r\n        isLeaf: value.type === 2,\r\n        // disabled: value.type === 2\r\n        selectable: value.type === 2\r\n      } as TreeDataItem\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.ant-form {\r\n  padding: 5px 0px;\r\n}\r\n.avatar-uploader > ::v-deep(.ant-upload) {\r\n  width: 130px;\r\n  height: 180px;\r\n}\r\n.ant-upload-select-picture-card i {\r\n  font-size: 32px;\r\n  color: #999;\r\n}\r\n\r\n.ant-upload-select-picture-card .ant-upload-text {\r\n  margin-top: 8px;\r\n  color: #666;\r\n}\r\n</style>\r\n","import Page from '@/types/Page'\r\nimport Pageable from '@/types/Pageable'\r\nimport { User } from '@/types/User'\r\nimport BaseRequest from './BaseRequest'\r\n\r\n/** 用户请求 */\r\nexport class UserRequest extends BaseRequest {\r\n    /** 根据ID查询用户 */\r\n    find(id: number) {\r\n        return super.get<User>(`/user/get/${id}`)\r\n    }\r\n\r\n    /** 根据ID删除用户 */\r\n    delete(id: number) {\r\n        return super.get(`/user/delete/${id}`)\r\n    }\r\n\r\n    /** 添加用户 */\r\n    add(user: User) {\r\n        return super.post('/user/add', user)\r\n    }\r\n\r\n    /** 更新用户 */\r\n    update(user: User) {\r\n        return super.post('/user/update', user)\r\n    }\n\r\n    /**\r\n     * 用户置顶\r\n     * @param userId 用户ID\r\n     * @param deptId 部门ID\r\n     * @returns R<boolean>\r\n     */\r\n    top(userId: number, deptId: number) {\r\n        return super.get(`/user/top?userId=${userId}&deptId=${deptId}`)\r\n    }\r\n\r\n    /** 分页查询 */\r\n    pageList(pageable: Pageable) {\r\n        return super.post<Page<User>>('/user/page', pageable)\r\n    }\r\n}\r\nconst request = new UserRequest()\r\nexport default request\r\n","\r\nimport { PropType, ref, toRaw, unref } from 'vue'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport {\r\n  UserOutlined,\r\n  LockOutlined,\r\n  MobileOutlined,\r\n  MailOutlined,\r\n  PlusOutlined,\r\n  LoadingOutlined\r\n} from '@ant-design/icons-vue'\r\nimport { User } from '@/types/User'\r\nimport Dialog from '@/components/Dialog.vue'\r\nimport { ValidateErrorEntity } from 'ant-design-vue/es/form/interface'\r\nimport request from '@/request/UserRequest'\r\nimport GroupRequest from '@/request/GroupRequest'\r\nimport { message } from 'ant-design-vue'\r\nimport { TreeDataItem } from 'ant-design-vue/es/tree/Tree'\r\nimport { R } from '@/types/R'\r\nimport { TreeNode } from '@/types/TreeNode'\r\n\r\ninterface FileItem {\r\n  uid: string;\r\n  name?: string;\r\n  status?: string;\r\n  response?: R<any>;\r\n  url?: string;\r\n  type?: string;\r\n  size: number;\r\n  originFileObj: any;\r\n}\r\n\r\ninterface FileInfo {\r\n  file: FileItem;\r\n  fileList: FileItem[];\r\n}\r\n\r\n@Options({\r\n  components: {\r\n    UserOutlined,\r\n    LockOutlined,\r\n    MobileOutlined,\r\n    MailOutlined,\r\n    PlusOutlined,\r\n    LoadingOutlined\r\n  },\r\n  props: {\r\n    id: {\r\n      type: Number\r\n    },\r\n    deptId: {\r\n      type: Number\r\n    },\r\n    deptName: {\r\n      type: String\r\n    },\r\n    dialog: Object as PropType<Dialog>\r\n  }\r\n})\r\nexport default class UserForm extends Vue {\r\n  // 当前弹框\r\n  dialog!: Dialog\r\n  // 用户ID\r\n  id!: number\r\n  // 部门\r\n  deptId!: number\r\n  deptName!: string\r\n  // 用户对象数据\r\n  user: User = {\r\n    status: 1,\r\n    deptId: this.deptId,\r\n    deptName: this.deptName\r\n  }\r\n\r\n  // 头像上传标志\r\n  avatarLoading = false\r\n  // 组织树数据源\r\n  treeData: TreeDataItem[] = []\r\n  // 表单引用\r\n  formRef = ref<AntType.Form>()\r\n  // 验证规则\r\n  rules = {\r\n    name: [{ required: true, message: '请输入姓名', trigger: 'blur' }, { max: 20, message: '最多输入20个字符' }],\r\n    account: [{ required: true, message: '请输入账号', trigger: 'blur' }, { max: 20, message: '最多输入20个字符' }],\r\n    post: [{ max: 20, message: '最多输入20个字符' }],\r\n    password: [\r\n      { required: false, message: '请输入密码', trigger: 'blur' },\r\n      { min: 6, max: 15, message: '密码为6-15位字符串', trigger: 'blur' }\r\n    ],\r\n    phone: [\r\n      { max: 11, message: '手机号最多为11个数字', trigger: 'blur' },\r\n      { pattern: /^1[0-9]{10}$/, message: '手机号码错误', trigger: 'blur' }\r\n    ],\r\n    email: [\r\n      {\r\n        pattern: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)*(\\.[a-z]{2,})$/,\r\n        message: '邮箱地址错误',\r\n        trigger: 'blur'\r\n      },\r\n      { max: 50, message: '最多输入50个字符' }\r\n    ]\r\n  }\r\n\r\n  // 用户头像地址\r\n  get avatarUrl() {\r\n    // 更换头像\r\n    if (this.user.reavatar) {\r\n      return `/file/download/thumb/${this.user.reavatar}`\r\n    } else {\r\n      return `/file/download/thumb/${this.user.avatar}`\r\n    }\r\n  }\r\n\r\n  // 上传头像数据\r\n  get avatarData() {\r\n    return { objectName: this.user.avatar || '' }\r\n  }\r\n\r\n  // 头像上传前回调\r\n  beforeUpload(file: FileItem) {\r\n    const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'\r\n    if (!isJpgOrPng) {\r\n      message.error('You can only upload JPG file!')\r\n    }\r\n    const isLt2M = file.size / 1024 / 1024 < 2\r\n    if (!isLt2M) {\r\n      message.error('Image must smaller than 2MB!')\r\n    }\r\n    return isJpgOrPng && isLt2M\r\n  }\r\n\r\n  // 上传事件\r\n  handleUploadChange = (info: FileInfo) => {\r\n    if (info.file.status === 'uploading') {\r\n      this.avatarLoading = true\r\n      return false\r\n    }\r\n    this.avatarLoading = false\r\n    if (info.file.status === 'done') {\r\n      if (info.file.response?.code === 0) {\r\n        this.user.avatar = info.file.response.data.objectName\r\n        this.user.reavatar = this.user.avatar + '?random=' + Math.random()\r\n      } else {\r\n        message.error(info.file.response?.msg as string)\r\n      }\r\n    }\r\n    if (info.file.status === 'error') {\r\n      message.error('上传失败')\r\n    }\r\n  }\r\n\r\n  // 挂载后执行\r\n  async mounted() {\r\n    // 加载组织树数据\r\n    const ret = await GroupRequest.children()\r\n    if (ret.code === 0) {\r\n      this.treeData = this.toChildren(ret)\r\n    } else {\r\n      message.error(ret.msg)\r\n    }\r\n    // 加载用户信息\r\n    if (this.id) {\r\n      const ret = await request.find(this.id)\r\n      if (ret.code === 0) {\r\n          this.user = ret.data\r\n        } else {\r\n          message.error(ret.msg)\r\n        }\r\n    } else {\r\n      // 新增用户需要校验密码\r\n      this.rules.password[0].required = true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 加载节点数据\r\n   */\r\n  onLoadData(treeNode: { dataRef: TreeDataItem }) {\r\n    return new Promise((resolve: (value?: unknown) => void) => {\r\n      if (treeNode.dataRef.children) {\r\n        resolve()\r\n        return false\r\n      }\r\n      GroupRequest.children(treeNode.dataRef.rawId as number).then((ret) => {\r\n        treeNode.dataRef.children = this.toChildren(ret)\r\n        this.treeData = [...this.treeData]\r\n        resolve()\r\n        this.user.deptId = this.user.deptId || 0\r\n      })\r\n    })\r\n  }\r\n\r\n  // 保存\r\n  onSubmit() {\r\n    const formUnref = unref(this.formRef)\r\n    formUnref &&\r\n      formUnref\r\n        .validate()\r\n        .then(async () => {\r\n          let ret\r\n          const formData = toRaw(this.user)\r\n          if (!this.user.id) {\r\n            ret = await request.add(formData)\r\n          } else {\r\n            ret = await request.update(formData)\r\n          }\r\n          if (ret.code === 0) {\r\n            this.dialog._ok()\r\n          } else {\r\n            message.error(ret.msg)\r\n          }\r\n        })\r\n        .catch((error: ValidateErrorEntity<User>) => {\r\n          console.log('error', error)\r\n        })\r\n  }\r\n\r\n  // 取消\r\n  onCancel() {\r\n    this.dialog._close()\r\n  }\r\n\r\n  // 用户状态切换\r\n  handleUserStatus() {\r\n    this.user.status = this.user.status === 1 ? 0 : 1\r\n  }\r\n\r\n  // 切换用户部门\r\n  handleDeptChange(value: any, label: any, extra: any) {\r\n    // console.log('选择部门', extra.triggerNode.dataRef)\r\n    this.user.deptId = extra.triggerNode.dataRef.rawId\r\n  }\r\n\r\n  // 转为树节点类型\r\n  toChildren(ret: R<TreeNode[]>) {\r\n    return ret.data.map((value) => {\r\n      return {\r\n        key: value.id,\r\n        rawId: value.rawId,\r\n        type: value.type, // 节点类型 0虚拟节点 1组织 2部门\r\n        value: value.id,\r\n        title: value.name,\r\n        code: value.code,\r\n        isLeaf: value.type === 2,\r\n        // disabled: value.type === 2\r\n        selectable: value.type === 2\r\n      } as TreeDataItem\r\n    })\r\n  }\r\n}\r\n","import { render } from \"./UserForm.vue?vue&type=template&id=61621a96&scoped=true\"\nimport script from \"./UserForm.vue?vue&type=script&lang=ts\"\nexport * from \"./UserForm.vue?vue&type=script&lang=ts\"\n\nimport \"./UserForm.vue?vue&type=style&index=0&id=61621a96&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-61621a96\"\n\nexport default script","<template>\r\n  <a-form\r\n    ref=\"formRef\"\r\n    :model=\"formData\"\r\n    :rules=\"rules\"\r\n    :label-col=\"{ span: 4 }\"\r\n    :wrapper-col=\"{ span: 18 }\"\r\n    style=\"margin-top: 15px\"\r\n  >\r\n    <a-form-item label=\"节点名称\" name=\"name\">\r\n      <a-input v-model:value=\"formData.name\" />\r\n    </a-form-item>\r\n    <a-form-item\r\n      v-if=\"!isTop\"\r\n      label=\"上级单位\"\r\n      name=\"parentId\"\r\n    >\r\n      <a-tree-select\r\n        :disabled=\"!!id\"\r\n        :tree-data=\"treeData\"\r\n        :load-data=\"onLoadData\"\r\n        v-model:value=\"formData.parentName\"\r\n        @change=\"onSelectChange\"\r\n        @treeExpand=\"onSelectTreeExpand\"\r\n        tree-default-expand-all\r\n        style=\"width: 100%\"\r\n        placeholder=\"请选择上级单位\"\r\n        :dropdown-style=\"{ maxHeight: '400px', overflow: 'auto' }\"\r\n      />\r\n    </a-form-item>\r\n    <a-form-item v-if=\"!isTop && type == 1\" label=\"虚拟节点\" name=\"virtual\">\r\n      <a-radio-group v-model:value=\"formData.virtual\">\r\n        <a-radio :value=\"true\">是</a-radio>\r\n        <a-radio :value=\"false\">否</a-radio>\r\n      </a-radio-group>\r\n    </a-form-item>\r\n    <a-form-item v-if=\"!isTop\" label=\"节点状态\" name=\"enabled\">\r\n      <a-switch v-model:checked=\"formData.enabled\" />\r\n    </a-form-item>\r\n    <a-form-item :wrapper-col=\"{ span: 14, offset: 4 }\">\r\n      <a-button type=\"primary\" @click=\"onSubmit\">提交</a-button>\r\n      <a-button style=\"margin-left: 10px\" @click=\"onCancel\">取消</a-button>\r\n    </a-form-item>\r\n  </a-form>\r\n</template>\r\n<script lang=\"ts\">\r\nimport Dialog from '@/components/Dialog.vue'\r\nimport request from '@/request/GroupRequest'\r\nimport { Group } from '@/types/Group'\r\nimport { R } from '@/types/R'\r\nimport { PropType, ref, toRaw, unref } from '@vue/runtime-core'\r\nimport { ValidateErrorEntity } from 'ant-design-vue/es/form/interface'\r\nimport { message } from 'ant-design-vue'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport { TreeDataItem } from 'ant-design-vue/es/tree/Tree'\r\nimport { TreeNode } from '@/types/TreeNode'\r\nimport { TreeNodeType } from '@/types/TreeNodeType'\r\n/**\r\n * 组织机构表单\r\n */\r\n@Options({\r\n  props: {\r\n    id: {\r\n      type: Number\r\n    },\r\n    type: {\r\n      type: Number\r\n    },\r\n    parentId: {\r\n      type: Number\r\n    },\r\n    parentType: {\r\n      type: Number\r\n    },\r\n    parentName: {\r\n      type: String\r\n    },\r\n    dialog: Object as PropType<Dialog>\r\n  }\r\n})\r\nexport default class GroupForm extends Vue {\r\n  // 节点ID\r\n  id!: number\r\n  // 节点类型\r\n  type!: number\r\n  // 父级节点\r\n  parentId!: number\r\n  parentType!: number\r\n  parentName!: string\r\n  // 当前弹框\r\n  dialog!: Dialog\r\n  // 组织树数据源\r\n  treeData: TreeDataItem[] = []\r\n  // 表单数据\r\n  formData: Group & {\r\n    enabled?: boolean;\r\n    virtual?: boolean;\r\n    parentName?: string;\r\n  } = {\r\n    id: this.id,\r\n    type: this.type,\r\n    enabled: true, // 默认启用\r\n    virtual: false, // 默认非虚拟节点\r\n    parentId: this.parentId,\r\n    parentType: this.parentType,\r\n    parentName: this.parentName\r\n  }\r\n\r\n  // 表单引用\r\n  formRef = ref<AntType.Form>()\r\n  // 验证规则\r\n  rules = {\r\n    name: [\r\n      { required: true, message: '请输入名称', trigger: 'blur' },\r\n      { max: 50, message: '名称最多50个字符' }\r\n    ],\r\n    parentId: [{ required: true, message: '请选择上级单位', trigger: 'blur', type: 'number' }]\r\n  }\r\n\r\n  // 是否顶级单位\r\n  get isTop() {\r\n    return !(this.parentId || this.formData.parentId)\r\n  }\r\n\r\n  // 加载数据\r\n  async mounted() {\r\n    // 加载组织机构根节点\r\n    const ret = await request.loadGroupNodes()\r\n    if (ret.code !== 0) {\r\n      message.error(ret.msg)\r\n      return false\r\n    }\r\n    this.treeData = this.toAntTreeNodes(ret.data)\r\n\r\n    // 加载当前节点\r\n    if (this.id) {\r\n      const ret = await request.find(this.id)\r\n      if (ret.code !== 0) {\r\n        message.error(ret.msg)\r\n        return false\r\n      }\r\n      this.formData = {\r\n        ...this.formData,\r\n        ...ret.data,\r\n        parentName: ret.data.parentType + '_' + ret.data.parentId\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 加载节点数据\r\n   */\r\n  onLoadData(treeNode: { dataRef: TreeDataItem }) {\r\n    return new Promise((resolve: (value?: unknown) => void) => {\r\n      if (treeNode.dataRef.children) {\r\n        resolve()\r\n        return false\r\n      }\r\n      request.children(treeNode.dataRef.rawId as number).then((ret) => {\r\n        treeNode.dataRef.children = this.toChildren(ret)\r\n        this.treeData = [...this.treeData]\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  onSelectTreeExpand(expandedKeys: string[]) {\r\n    console.log(expandedKeys)\r\n  }\r\n\r\n  // 切换上级单位\r\n  onSelectChange(value: any, label: any, extra: any) {\r\n    // console.log(value, label, extra)\r\n    this.formData.parentId = extra.triggerNode.dataRef.rawId\r\n    this.formData.parentType = extra.triggerNode.dataRef.type\r\n  }\r\n\r\n  // 保存\r\n  onSubmit() {\r\n    const formUnref = unref(this.formRef)\r\n    formUnref &&\r\n      formUnref\r\n        .validate()\r\n        .then(async () => {\r\n          // 节点类型\r\n          if (this.formData.virtual) {\r\n            this.formData.type = 0\r\n          }\r\n          // 节点状态\r\n          this.formData.status = this.formData.enabled ? 1 : 0\r\n\r\n          let { enabled, virtual, parentName, ...data } = toRaw(this.formData)\r\n\r\n          let ret\r\n          if (!this.id) {\r\n            ret = await request.add(data)\r\n            data = (await request.find(ret.data)).data\r\n          } else {\r\n            ret = await request.update(data)\r\n          }\r\n          if (ret.code === 0) {\r\n            this.dialog._ok(data)\r\n          } else {\r\n            message.error(`错误:${ret.msg}`)\r\n          }\r\n        }).catch((error: ValidateErrorEntity<Group>) => {\r\n          console.log('error', error)\r\n        })\r\n  }\r\n\r\n  // 取消\r\n  onCancel() {\r\n    this.dialog._close()\r\n  }\r\n\r\n  // 转为树节点类型\r\n  toChildren(ret: R<TreeNode[]>) {\r\n    return ret.data.map((node) => {\r\n      return {\r\n        key: node.id,\r\n        rawId: node.rawId,\r\n        type: node.type,\r\n        value: node.id,\r\n        title: node.name,\r\n        code: node.code,\r\n        isLeaf: node.type === TreeNodeType.DEPT,\r\n        // disabled: value.type === TreeNodeType.DEPT\r\n        selectable: node.type === TreeNodeType.GROUP\r\n      } as TreeDataItem\r\n    })\r\n  }\r\n\r\n  // 转换为 Ant树节点\r\n  toAntTreeNodes(nodes: TreeNode[]): TreeDataItem[] {\r\n    return nodes.map((node) => {\r\n      return {\r\n        key: node.id,\r\n        rawId: node.rawId,\r\n        type: node.type, // 节点类型 0虚拟节点 1单位 2部门\r\n        value: node.id,\r\n        title: node.name,\r\n        code: node.code,\r\n        isLeaf: node.type === TreeNodeType.DEPT,\r\n        // disabled: node.type === TreeNodeType.DEPT\r\n        selectable: node.type === TreeNodeType.GROUP,\r\n        children: this.toAntTreeNodes(node.children)\r\n      } as TreeDataItem\r\n    })\r\n  }\r\n}\r\n</script>\r\n","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose.js\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","\r\nimport Dialog from '@/components/Dialog.vue'\r\nimport request from '@/request/GroupRequest'\r\nimport { Group } from '@/types/Group'\r\nimport { R } from '@/types/R'\r\nimport { PropType, ref, toRaw, unref } from '@vue/runtime-core'\r\nimport { ValidateErrorEntity } from 'ant-design-vue/es/form/interface'\r\nimport { message } from 'ant-design-vue'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport { TreeDataItem } from 'ant-design-vue/es/tree/Tree'\r\nimport { TreeNode } from '@/types/TreeNode'\r\nimport { TreeNodeType } from '@/types/TreeNodeType'\r\n/**\r\n * 组织机构表单\r\n */\r\n@Options({\r\n  props: {\r\n    id: {\r\n      type: Number\r\n    },\r\n    type: {\r\n      type: Number\r\n    },\r\n    parentId: {\r\n      type: Number\r\n    },\r\n    parentType: {\r\n      type: Number\r\n    },\r\n    parentName: {\r\n      type: String\r\n    },\r\n    dialog: Object as PropType<Dialog>\r\n  }\r\n})\r\nexport default class GroupForm extends Vue {\r\n  // 节点ID\r\n  id!: number\r\n  // 节点类型\r\n  type!: number\r\n  // 父级节点\r\n  parentId!: number\r\n  parentType!: number\r\n  parentName!: string\r\n  // 当前弹框\r\n  dialog!: Dialog\r\n  // 组织树数据源\r\n  treeData: TreeDataItem[] = []\r\n  // 表单数据\r\n  formData: Group & {\r\n    enabled?: boolean;\r\n    virtual?: boolean;\r\n    parentName?: string;\r\n  } = {\r\n    id: this.id,\r\n    type: this.type,\r\n    enabled: true, // 默认启用\r\n    virtual: false, // 默认非虚拟节点\r\n    parentId: this.parentId,\r\n    parentType: this.parentType,\r\n    parentName: this.parentName\r\n  }\r\n\r\n  // 表单引用\r\n  formRef = ref<AntType.Form>()\r\n  // 验证规则\r\n  rules = {\r\n    name: [\r\n      { required: true, message: '请输入名称', trigger: 'blur' },\r\n      { max: 50, message: '名称最多50个字符' }\r\n    ],\r\n    parentId: [{ required: true, message: '请选择上级单位', trigger: 'blur', type: 'number' }]\r\n  }\r\n\r\n  // 是否顶级单位\r\n  get isTop() {\r\n    return !(this.parentId || this.formData.parentId)\r\n  }\r\n\r\n  // 加载数据\r\n  async mounted() {\r\n    // 加载组织机构根节点\r\n    const ret = await request.loadGroupNodes()\r\n    if (ret.code !== 0) {\r\n      message.error(ret.msg)\r\n      return false\r\n    }\r\n    this.treeData = this.toAntTreeNodes(ret.data)\r\n\r\n    // 加载当前节点\r\n    if (this.id) {\r\n      const ret = await request.find(this.id)\r\n      if (ret.code !== 0) {\r\n        message.error(ret.msg)\r\n        return false\r\n      }\r\n      this.formData = {\r\n        ...this.formData,\r\n        ...ret.data,\r\n        parentName: ret.data.parentType + '_' + ret.data.parentId\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 加载节点数据\r\n   */\r\n  onLoadData(treeNode: { dataRef: TreeDataItem }) {\r\n    return new Promise((resolve: (value?: unknown) => void) => {\r\n      if (treeNode.dataRef.children) {\r\n        resolve()\r\n        return false\r\n      }\r\n      request.children(treeNode.dataRef.rawId as number).then((ret) => {\r\n        treeNode.dataRef.children = this.toChildren(ret)\r\n        this.treeData = [...this.treeData]\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  onSelectTreeExpand(expandedKeys: string[]) {\r\n    console.log(expandedKeys)\r\n  }\r\n\r\n  // 切换上级单位\r\n  onSelectChange(value: any, label: any, extra: any) {\r\n    // console.log(value, label, extra)\r\n    this.formData.parentId = extra.triggerNode.dataRef.rawId\r\n    this.formData.parentType = extra.triggerNode.dataRef.type\r\n  }\r\n\r\n  // 保存\r\n  onSubmit() {\r\n    const formUnref = unref(this.formRef)\r\n    formUnref &&\r\n      formUnref\r\n        .validate()\r\n        .then(async () => {\r\n          // 节点类型\r\n          if (this.formData.virtual) {\r\n            this.formData.type = 0\r\n          }\r\n          // 节点状态\r\n          this.formData.status = this.formData.enabled ? 1 : 0\r\n\r\n          let { enabled, virtual, parentName, ...data } = toRaw(this.formData)\r\n\r\n          let ret\r\n          if (!this.id) {\r\n            ret = await request.add(data)\r\n            data = (await request.find(ret.data)).data\r\n          } else {\r\n            ret = await request.update(data)\r\n          }\r\n          if (ret.code === 0) {\r\n            this.dialog._ok(data)\r\n          } else {\r\n            message.error(`错误:${ret.msg}`)\r\n          }\r\n        }).catch((error: ValidateErrorEntity<Group>) => {\r\n          console.log('error', error)\r\n        })\r\n  }\r\n\r\n  // 取消\r\n  onCancel() {\r\n    this.dialog._close()\r\n  }\r\n\r\n  // 转为树节点类型\r\n  toChildren(ret: R<TreeNode[]>) {\r\n    return ret.data.map((node) => {\r\n      return {\r\n        key: node.id,\r\n        rawId: node.rawId,\r\n        type: node.type,\r\n        value: node.id,\r\n        title: node.name,\r\n        code: node.code,\r\n        isLeaf: node.type === TreeNodeType.DEPT,\r\n        // disabled: value.type === TreeNodeType.DEPT\r\n        selectable: node.type === TreeNodeType.GROUP\r\n      } as TreeDataItem\r\n    })\r\n  }\r\n\r\n  // 转换为 Ant树节点\r\n  toAntTreeNodes(nodes: TreeNode[]): TreeDataItem[] {\r\n    return nodes.map((node) => {\r\n      return {\r\n        key: node.id,\r\n        rawId: node.rawId,\r\n        type: node.type, // 节点类型 0虚拟节点 1单位 2部门\r\n        value: node.id,\r\n        title: node.name,\r\n        code: node.code,\r\n        isLeaf: node.type === TreeNodeType.DEPT,\r\n        // disabled: node.type === TreeNodeType.DEPT\r\n        selectable: node.type === TreeNodeType.GROUP,\r\n        children: this.toAntTreeNodes(node.children)\r\n      } as TreeDataItem\r\n    })\r\n  }\r\n}\r\n","import { render } from \"./GroupForm.vue?vue&type=template&id=d5f6fa0e\"\nimport script from \"./GroupForm.vue?vue&type=script&lang=ts\"\nexport * from \"./GroupForm.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\r\nimport { TreeDataItem, SelectEvent } from 'ant-design-vue/es/tree/Tree'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport { message, Modal } from 'ant-design-vue'\r\nimport request from '@/request/GroupRequest'\r\nimport { R } from '@/types/R'\r\nimport { Group } from '@/types/Group'\r\nimport { TreeNode } from '@/types/TreeNode'\r\nimport UserForm from './UserForm.vue'\r\nimport GroupForm from './GroupForm.vue'\r\nimport { TreeNodeType } from '@/types/TreeNodeType'\r\n// 右键菜单键\r\nenum ContextMenuKeys {\r\n  // 新增人员\r\n  ADD_USER,\r\n  // 添加部门\r\n  ADD_DEPT,\r\n  // 添加单位\r\n  ADD_GROUP,\r\n  // 更新部门\r\n  UPDATE_DEPT,\r\n  // 更新单位\r\n  UPDATE_GROUP,\r\n  // 删除部门\r\n  DELETE_DEPT,\r\n  // 删除单位\r\n  DELETE_GROUP\r\n}\r\n\r\n/**\r\n * 组织机构管理\r\n */\r\n@Options({\r\n  emits: ['select']\r\n})\r\nexport default class GroupVue extends Vue {\r\n  // 组织树数据源\r\n  treeData: TreeDataItem[] = []\r\n  // 展开的KEY\r\n  expandedKeys: string[] = []\r\n  // 右键菜单枚举\r\n  contextMenuKeys = ContextMenuKeys\r\n  /**\r\n   * 页面挂载后\r\n   */\r\n  async mounted() {\r\n    // 加载组织机构根节点\r\n    const ret = await request.children()\r\n    if (ret.code !== 0) {\r\n      message.error(ret.msg)\r\n      return false\r\n    }\r\n    this.treeData = this.toChildren(ret)\r\n  }\r\n\r\n  /**\r\n   * 加载节点数据\r\n   */\r\n  onLoadData(treeNode: TreeDataItem) {\r\n    return new Promise((resolve: (value?: unknown) => void) => {\r\n      if (treeNode.dataRef.children) {\r\n        resolve()\r\n        return false\r\n      }\r\n      request.children(treeNode.dataRef.rawId as number).then((ret) => {\r\n        treeNode.dataRef.children = this.toChildren(ret)\r\n        this.treeData = [...this.treeData]\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  // 节点点击事件\r\n  onSelect(selectedKeys: string[], info: SelectEvent) {\r\n    this.$emit('select', selectedKeys, info)\r\n  }\r\n\r\n  // 右键菜单\r\n  onContextMenuClick(node: TreeDataItem, e: { key: ContextMenuKeys; [key: string]: any }) {\r\n    const menuKey = e.key\r\n    let title\r\n    let formData: {\r\n      id?: number; // rawId\r\n      type: number; // enum NodeType\r\n      parentId?: number; // 父节点ID\r\n      parentType?: number; // 父节点类型\r\n      parentName?: string; // 父节点名称\r\n    }\r\n    if (ContextMenuKeys.ADD_DEPT === menuKey) {\r\n      title = '新增部门'\r\n      formData = {\r\n        type: TreeNodeType.DEPT,\r\n        parentId: node.rawId,\r\n        parentType: node.type,\r\n        parentName: node.title\r\n      }\r\n    } else if (ContextMenuKeys.ADD_GROUP === menuKey) {\r\n      title = '新增单位'\r\n      formData = {\r\n        type: TreeNodeType.GROUP,\r\n        parentId: node.rawId,\r\n        parentType: node.type,\r\n        parentName: node.title\r\n      }\r\n    } else if (ContextMenuKeys.UPDATE_DEPT === menuKey) {\r\n      title = '更新部门'\r\n      formData = {\r\n        id: node.rawId,\r\n        type: TreeNodeType.DEPT\r\n      }\r\n    } else if (ContextMenuKeys.UPDATE_GROUP === menuKey) {\r\n      title = '更新单位'\r\n      formData = {\r\n        id: node.rawId,\r\n        type: TreeNodeType.GROUP\r\n      }\r\n    } else if (\r\n      ContextMenuKeys.DELETE_DEPT === menuKey ||\r\n      ContextMenuKeys.DELETE_GROUP === menuKey\r\n    ) {\r\n      Modal.confirm({\r\n        title: `您确定要删除<${node.title}>吗?`,\r\n        okType: 'danger',\r\n        onOk: () => {\r\n          request\r\n            .delete(node.rawId)\r\n            .then((res) => {\r\n              if (res.code === 0) {\r\n                message.success('删除成功')\r\n                this.loop(\r\n                  this.treeData,\r\n                  node.key as string,\r\n                  (item, index, arr) => {\r\n                    arr.splice(index, 1)\r\n                  }\r\n                )\r\n              } else {\r\n                message.error('删除失败:' + res.msg)\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              message.error(err.message)\r\n            })\r\n        }\r\n      })\r\n\r\n      return false\r\n    } else if (ContextMenuKeys.ADD_USER === menuKey) {\r\n      this.$dialog({\r\n        title: '新增用户',\r\n        width: 550,\r\n        height: 650,\r\n        max: false,\r\n        content: {\r\n          handle: true,\r\n          component: UserForm,\r\n          props: { deptId: node.rawId, deptName: node.title }\r\n        },\r\n        ok: () => {\r\n            this.$emit('select', [node.key], {\r\n                node: {\r\n                    dataRef: {\r\n                        code: node.code\r\n                    }\r\n                }\r\n            })\r\n            return true\r\n        }\r\n      })\r\n      return false\r\n    } else {\r\n      console.log(`unknow menukey ${menuKey}`)\r\n      return false\r\n    }\r\n    this.$dialog({\r\n      title: title,\r\n      width: 550,\r\n      height: 400,\r\n      content: {\r\n        handle: true,\r\n        props: formData,\r\n        component: GroupForm\r\n      },\r\n      ok: (args: unknown[]) => {\r\n        const data = args[0] as Group\r\n        const key = `${data.type}_${data.id}`\r\n        const parentKey = `${formData.parentType}_${formData.parentId}`\r\n        const treeNode = {\r\n                            id: key,\r\n                            rawId: data.id,\r\n                            type: data.type,\r\n                            name: data.name,\r\n                            code: data.code\r\n                          } as TreeNode\r\n        if (node.key === key) {\r\n          // 更新节点名称\r\n          node.dataRef.title = data.name\r\n        } else if (node.key === parentKey) {\r\n          // 当前节点下新增\r\n          if (node.dataRef.children) {\r\n            node.dataRef.children.push(this.dataToTreeDataItem(treeNode))\r\n          } else {\r\n            this.onLoadData(node)\r\n          }\r\n        } else {\r\n          // 非当前节点下新增\r\n          this.loop(\r\n            this.treeData,\r\n            parentKey,\r\n            (item, index, arr) => {\r\n              item.children && item.children.push(this.dataToTreeDataItem(treeNode))\r\n            }\r\n          )\r\n        }\r\n        return true\r\n      }\r\n    })\r\n  }\r\n\r\n  // 属性监听\r\n  watchExpandedKeys(value: string[], oldValue: string[]) {\r\n    console.log('expandedKeys', value, oldValue)\r\n  }\r\n\r\n  // 转为树节点类型\r\n  toChildren(ret: R<TreeNode[]>) {\r\n    return ret.data.map((value) => {\r\n      return this.dataToTreeDataItem(value)\r\n    })\r\n  }\r\n\r\n  // 数据转树节点\r\n  dataToTreeDataItem(data: TreeNode) {\r\n    return {\r\n      key: data.id,\r\n      type: data.type,\r\n      title: data.name,\r\n      code: data.code,\r\n      rawId: data.rawId,\r\n      sort: data.sort,\r\n      parentId: data.parentId,\r\n      isLeaf: data.type === TreeNodeType.DEPT\r\n    } as TreeDataItem\r\n  }\r\n\r\n  // 查询树节点\r\n  loop(\r\n    data: TreeDataItem[],\r\n    key: string,\r\n    callback: (item: TreeDataItem, index: number, arr: TreeDataItem[]) => void\r\n  ) {\r\n    data.forEach((item, index, arr) => {\r\n      if (item.key === key) {\r\n        return callback(item, index, arr)\r\n      }\r\n      if (item.children) {\r\n        return this.loop(item.children, key, callback)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 拖拽排序\r\n  onDrop(info: { node: TreeDataItem; dragNode: TreeDataItem; dropToGap: boolean; dropPosition: number; [key: string]: any }) {\r\n    // console.log(info)\r\n    // 忽略拖入节点内的操作\r\n    if (!info.dropToGap) {\r\n      return false\r\n    }\r\n    // 只能同一层级内拖拽\r\n    const dragPos = info.dragNode.pos as string\r\n    if (info.node.pos.substring(0, info.node.pos.length - 1) !== dragPos.substring(0, dragPos.length - 1)) {\r\n      return false\r\n    }\r\n    const dropKey = info.node.dataRef.key as string\r\n    const dragKey = info.dragNode.dataRef.key as string\r\n    const dropPos = info.node.pos.split('-')\r\n    const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1])\r\n\r\n    // Find dragObject\r\n    let dragIndex = 0\r\n    let dragObj: TreeDataItem = {}\r\n    this.loop(this.treeData, dragKey, (item: TreeDataItem, index: number, arr: TreeDataItem[]) => {\r\n      arr.splice(index, 1)\r\n      dragObj = item\r\n      dragIndex = index\r\n    })\r\n\r\n    let dropIndex = 0\r\n    let nodes: TreeDataItem[] = []\r\n    this.loop(this.treeData, dropKey, (_item: TreeDataItem, index: number, arr: TreeDataItem[]) => {\r\n      nodes = arr\r\n      dropIndex = index\r\n    })\r\n    // debugger\r\n    if (dropPosition === -1) {\r\n      nodes.splice(dropIndex, 0, dragObj)\r\n    } else {\r\n      nodes.splice(dropIndex + 1, 0, dragObj)\r\n    }\r\n\r\n    // 重新查找拖拽节点, 向上拖拽取下节点，向下拖拽取上节点\r\n    let targetNode: TreeDataItem = {}\r\n    this.loop(this.treeData, dragKey, (item: TreeDataItem, index: number, arr: TreeDataItem[]) => {\r\n      if (index < dragIndex) {\r\n        targetNode = arr[index + 1]\r\n      } else if (index > dragIndex) {\r\n        targetNode = arr[index - 1]\r\n      }\r\n    })\r\n    if (!targetNode.key) {\r\n      return false\r\n    }\r\n    // 获取父节点ID\r\n    let parentId\r\n    this.loopParentNode(dragKey, {}, this.treeData, (pNode: TreeDataItem) => {\r\n      parentId = pNode.rawId\r\n    })\r\n    const dropSort = {\r\n      parent: parentId,\r\n      sort: dragObj.sort,\r\n      targetSort: targetNode.sort\r\n    }\r\n    request.dropSort(dropSort).then(ret => {\r\n      console.log(ret.code, ret.msg, ret.data)\r\n    })\r\n    return false\r\n  }\r\n\r\n  // 查询父节点\r\n  loopParentNode(key: string, pNode: TreeDataItem, children: TreeDataItem[], callback: (pNode: TreeDataItem) => void) {\r\n    children.forEach((item, index, arr) => {\r\n      if (key === item.key) {\r\n        return callback(pNode)\r\n      }\r\n      if (item.children) {\r\n        this.loopParentNode(key, item, item.children, callback)\r\n      }\r\n    })\r\n  }\r\n}\r\n","import { render } from \"./Group.vue?vue&type=template&id=1478e518\"\nimport script from \"./Group.vue?vue&type=script&lang=ts\"\nexport * from \"./Group.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\r\nimport { ref, unref } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { Options, Vue } from 'vue-class-component'\r\nimport { SearchOutlined } from '@ant-design/icons-vue'\r\nimport { SelectEvent } from 'ant-design-vue/es/tree/Tree'\r\nimport { TableState, TableStateFilters } from 'ant-design-vue/es/table/interface'\r\nimport { User } from '@/types/User'\r\nimport Group from './Group.vue'\r\nimport UserForm from './UserForm.vue'\r\nimport Pageable from '@/types/Pageable'\r\nimport request from '@/request/UserRequest'\r\n// 分页数据类型\r\ntype Pagination = TableState['pagination'];\r\n// 排序映射\r\nconst orderMap: {[key: string]: string} = {\r\n  ascend: 'ASC',\r\n  descend: 'DESC'\r\n}\r\n@Options({\r\n  components: {\r\n    Group,\r\n    SearchOutlined\r\n  }\r\n})\r\nexport default class VueUser extends Vue {\r\n  // 用户列定义\r\n  columns = [\r\n    {\r\n      title: '序号',\r\n      dataIndex: 'number',\r\n      width: 100,\r\n      customRender: (info: {\r\n        text: string;\r\n        record: User;\r\n        index: number;\r\n      }) => {\r\n        return (this.pageable.curr - 1) * this.pageable.size + info.index + 1\r\n      }\r\n    },\r\n    {\r\n      title: '姓名',\r\n      dataIndex: 'name',\r\n      slots: {\r\n        filterDropdown: 'filterDropdown',\r\n        filterIcon: 'filterIcon',\r\n        customRender: 'name'\r\n      },\r\n      onFilterDropdownVisibleChange: (visible: boolean) => {\r\n        if (visible) {\r\n          setTimeout(() => {\r\n            const searchInput = unref(this.searchInput)\r\n            searchInput && searchInput.focus()\r\n          }, 0)\r\n        }\r\n      }\r\n    },\r\n    { title: '账号', dataIndex: 'account' },\r\n    { title: '手机', dataIndex: 'phone', width: 200 },\r\n    { title: '邮箱', dataIndex: 'email', width: 200 },\r\n    { title: '更新时间', dataIndex: 'updateTime', width: 200, sorter: true, key: 'update_time' },\r\n    {\r\n        title: '状态',\r\n        width: 100,\r\n        dataIndex: 'status',\r\n        slots: { customRender: 'status' }\r\n    },\r\n    {\r\n      title: '操作',\r\n      dataIndex: 'operation',\r\n      width: 200,\r\n      slots: { customRender: 'operation' }\r\n    }\r\n  ]\r\n\r\n  // 表格数据\r\n  users: User[] = []\r\n\r\n  // 搜索\r\n  searchInput = ref<HTMLInputElement>()\r\n  searchText = ''\r\n  searchedColumn = ''\r\n\r\n  // 分页参数定义\r\n  pagination = {\r\n    total: 200,\r\n    current: 1,\r\n    pageSize: 10\r\n  }\r\n\r\n  // 分页条件\r\n  pageable: Pageable = {\r\n    curr: this.pagination.current,\r\n    size: this.pagination.pageSize,\r\n    condition: {}\r\n  }\r\n\r\n  mounted() {\r\n    this.pageQueryUser()\r\n  }\r\n\r\n  // 分页查询用户\r\n  async pageQueryUser() {\r\n    const result = await request.pageList(this.pageable)\r\n    if (result.code === 0) {\r\n      this.users = result.data.data\r\n      this.pagination.total = result.data.count\r\n    } else {\r\n      message.error(result.msg)\r\n    }\r\n  }\r\n\r\n  // 表格变动监听\r\n  handleTableChange(pag: Pagination, filters: TableStateFilters, sorter: {field: string; order: string; columnKey: string}) {\r\n      this.pagination.current = pag?.current || 1\r\n      this.pageable.curr = this.pagination.current\r\n      this.pageable.sortField = sorter.columnKey || ''\r\n      this.pageable.sortOrder = orderMap[sorter.order] || ''\r\n      this.pageable.condition.name = (filters.name instanceof Array ? filters.name[0] : '')\r\n      this.pageQueryUser()\r\n  }\r\n\r\n  /** 列表搜索 */\r\n  handleSearch(selectedKeys: string[], confirm: Function, dataIndex: string) {\r\n    confirm()\r\n    this.searchText = selectedKeys[0] || ''\r\n    this.searchedColumn = dataIndex\r\n  }\r\n\r\n  /** 查询条件重置 */\r\n  handleReset(clearFilters: Function) {\r\n    clearFilters()\r\n    this.searchText = ''\r\n  }\r\n\r\n  /** 删除人员 */\r\n  async onUserDel(user: User) {\r\n    const ret = await request.delete(user.id as number)\r\n    if (ret.code === 0) {\r\n      this.pageQueryUser()\r\n    } else {\r\n      message.error(`删除失败:${ret.msg}`)\r\n    }\r\n  }\r\n\r\n  // 编辑人员\r\n  onUserEdit(user: User) {\r\n    this.$dialog({\r\n      title: '用户信息',\r\n      width: 550,\r\n      height: 650,\r\n      max: false,\r\n      content: {\r\n        handle: true,\r\n        component: UserForm,\r\n        props: { id: user.id, deptId: user.deptId }\r\n      },\r\n      ok: () => {\r\n        this.pageQueryUser()\r\n        return true\r\n      }\r\n    })\r\n  }\r\n\r\n  // 人员置顶\r\n  async onUserTop(user: User) {\r\n    const ret = await request.top(user.id as number, user.deptId as number)\r\n    if (ret.code === 0) {\r\n      this.pageQueryUser()\r\n    } else {\r\n      message.error(`置顶失败:${ret.msg}`)\r\n    }\r\n  }\r\n\r\n  userStatus(user: User) {\r\n    return user.status === 1\r\n  }\r\n\r\n  /** 改变用户状态 */\r\n  async onUserChange(user: User) {\r\n    user.status = user.status === 1 ? 0 : 1\r\n    const ret = await request.update(user)\r\n    if (ret.code !== 0) {\r\n      message.error(ret.msg)\r\n      user.status = user.status === 1 ? 0 : 1\r\n    }\r\n  }\r\n\r\n  // 节点选择\r\n  onSelectGroup(selectedKeys: string[], info: SelectEvent) {\r\n    // console.log(selectedKeys, info)\r\n    this.pageable.condition.orgcode = info.node.dataRef.code\r\n    this.pageQueryUser()\r\n  }\r\n}\r\n","import { render } from \"./User.vue?vue&type=template&id=dd77fd1e&scoped=true\"\nimport script from \"./User.vue?vue&type=script&lang=ts\"\nexport * from \"./User.vue?vue&type=script&lang=ts\"\n\nimport \"./User.vue?vue&type=style&index=0&id=dd77fd1e&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-dd77fd1e\"\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./User.vue?vue&type=style&index=0&id=dd77fd1e&scoped=true&lang=css\"","'use strict';\nvar $ = require('../internals/export');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\n\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.es/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = toLength(O.length);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toInteger(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./UserForm.vue?vue&type=style&index=0&id=61621a96&scoped=true&lang=css\""],"sourceRoot":""}